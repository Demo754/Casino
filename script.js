// DOM-elementer
const spinButton = document.getElementById('spinButton');
const resultDisplay = document.getElementById('result');
const balanceDisplay = document.getElementById('balance');
const reels = [
    document.getElementById('reel1'),
    document.getElementById('reel2'),
    document.getElementById('reel3'),
    document.getElementById('reel4'),
    document.getElementById('reel5')
];

// Symboler og vekting for spilleautomaten
const symbols = ['üçí', 'üçã', 'üçä', 'üçâ', '‚≠ê', 'üçÄ', 'üíé', 'üí£'];
const symbolWeights = {
    'üçí': 4, 'üçã': 3, 'üçä': 2, 'üçâ': 1.8,
    '‚≠ê': 0.8, 'üçÄ': 1.2, 'üíé': 0.3, 'üí£': 0.7
};

// Gevinstmultiplikator for antall like symboler
const winMultipliers = {
    'üçí': [0, 0, 15, 30, 60],
    'üçã': [0, 0, 25, 50, 100],
    'üçä': [0, 0, 35, 70, 150],
    'üçâ': [0, 0, 50, 100, 200],
    '‚≠ê': [0, 10, 50, 100, 200],
    'üíé': [0, 30, 100, 250, 500],
    'üçÄ': [0, 5, 75, 150, 300],
    'üí£': [0] // Ingen gevinst for bomben
};

// Startbalanse og l√•nebel√∏p
let balance = 40;  // Startbalanse
let loan = 0;  // L√•nebel√∏p

// Oppdater balansen i visningen
function updateBalanceDisplay() {
    balanceDisplay.textContent = `Balanse: ${balance} kr`;
}

// Tilfeldig symbolgenerator basert p√• vekting
function getRandomSymbol() {
    const weightedSymbols = Object.keys(symbolWeights).flatMap(
        symbol => Array(symbolWeights[symbol] * 10).fill(symbol)
    );
    return weightedSymbols[Math.floor(Math.random() * weightedSymbols.length)];
}

// Sjekk gevinst og h√•ndter bomben separat
function checkWin(results) {
    let winAmount = 0;
    let symbolCounts = {};  // Objekt for √• telle antall av hvert symbol

    // Hvis vi f√•r en bombe p√• noen hjul, trekker vi penger og stopper videre behandling
    if (results.includes('üí£')) {
        winAmount -= 150;  // Tapte 150 kr ved bombe
        resultDisplay.textContent = `üí£ Bombe! Du mistet 150 kr!`;
    } else {
        // Tell antall forekomster av hvert symbol
        results.forEach(symbol => {
            symbolCounts[symbol] = (symbolCounts[symbol] || 0) + 1;
        });

        // Beregn gevinsten basert p√• antall like symboler
        Object.keys(symbolCounts).forEach(symbol => {
            const count = symbolCounts[symbol];
            // Unng√• √• beregne gevinst for bomben (üí£)
            if (symbol !== 'üí£' && count > 0) {
                const multiplier = winMultipliers[symbol][count]; // Hent multiplikatoren for antall like symboler
                if (multiplier && typeof multiplier === 'number') {
                    winAmount += multiplier; // Legg til gyldig multiplikator
                }
            }
        });

        // Hvis ingen gevinster, vis en melding
        if (winAmount > 0) {
            resultDisplay.textContent = `Gratulerer! Du vant ${winAmount} kr!`;
        } else {
            resultDisplay.textContent = "Ingen gevinst denne gangen.";
        }
    }

    // Oppdater balansen etter at gevinster og eventuelle tap (bomben) er beregnet
    balance += winAmount;

    // S√∏rg for at balansen aldri g√•r under 0
    if (balance < 0) balance = 0;

    // Oppdater balansen p√• skjermen
    updateBalanceDisplay();
}

// Spin-logikken
function spinReels() {
    if (balance < 5) {  // Minimum 5 kr for spinn
        resultDisplay.textContent = "Ikke nok penger til √• spinne!";
        return;
    }

    balance -= 5;
    updateBalanceDisplay();
    resultDisplay.textContent = "Spinning...";

    reels.forEach(reel => reel.classList.add('spin'));

    setTimeout(() => {
        const spinResults = reels.map(reel => {
            const symbol = getRandomSymbol();
            reel.textContent = symbol;
            reel.classList.remove('spin');
            return symbol;
        });

        checkWin(spinResults);
    }, 500);
}

// Start spillet
updateBalanceDisplay();
spinButton.addEventListener('click', spinReels);
